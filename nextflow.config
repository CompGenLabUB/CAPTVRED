params{
  //environment parameters:
    wdir = "$BDIR"
    bindir="$BIND"
    amplicon_refseqs_dir="$AMPSQD"
    amplicon_refseqs_info="$AMPSQINFO"
    amplicon_refseqs="$AMPSQFA"
    blast_refseqs_dir="$BDBD"
    rawfq_dir="$RAWFQ"
    clnfq_dir="$CLNDIR"
    ampaln_dir="$AMPALD"
    asbl_dir="$ASSBLD"
    contigs_blast_dir="$CBLASTD"
    taxdir="$TAXDIR"
    reports_dir="$RPTD"
    logs_dir="$LOGD"
    kaijuDBD="$KAIDBD"

    runID = "$RUNID"
    R1="$R1"
    R2="$R2"
    
    // Input samples:
    rawfq = "$params.wdir/rawseqs_fastq/*{${R1},${R2}}.fastq.gz"
    sampletbl = "$params.wdir/samples_definition.tbl"
    
  //
    NCPUS = 32

  // Cleaning params (BBDuk):
    bbdukREF="\$BBDUK_PATH/resources/adapters.fa"
    bbdukMINLEN=32
    bbdukMAQ=10
    
  // Alignment params:

    alignMINQ=13
    
    
  // Assembly params:
    assembler="megahit"
    assemblyMINCONLEN=100;
    
    trinityMAXM="250G"
    megahit_errorHandler = "finish"
    
  // Blast params:
    blast_approach="BLASTN"
    blast_ref_db_name="C-RVDBvCurrent_blastdb"

    
    // do not modify! //
    bl_outfmt="6 qseqid qlen sseqid slen qstart qend sstart send"
    bl_outfmt= "${bl_outfmt} length score evalue bitscore pident"
    bl_outfmt= "${bl_outfmt} nident mismatch positive gapopen gaps"
    bl_outfmt= "${bl_outfmt} ppos qframe sframe qcovs qcovhsp qseq sseq";
    // do not modify! //
    
  // Kaiju Params:
    kaijuCPUS= 26
    kaijuMAX_FORKS=4
    kaijuMAX_RETRIES=2
    kaijuDBRAW="nr_euk"
    kaijudbs=["viruses", "rvdb", "capref"]
    

}

process {
    withLabel: 'trinity_crash' {
       errorStrategy = 'ignore'
    }
    
    withLabel: 'megahit_crash' {
       errorStrategy = params.megahit_errorHandler
    }

    withLabel: 'limit_kaiju' {
       errorStrategy = 'retry'
       maxRetries = params.kaijuMAX_RETRIES
       maxForks = params.kaijuMAX_FORKS
       cpus= params.kaijuCPUS
       
    }
}

env {

    //Fixing issues with python utf8 libraries
    LANG = "en_US.UTF-8"
    LC_CTYPE = "en_US.UTF-8"
    LC_NUMERIC = "en_US.UTF-8"
    LC_TIME = "en_US.UTF-8"
    LC_COLLATE = "en_US.UTF-8"
    LC_MONETARY = "en_US.UTF-8"
    LC_MESSAGES = "en_US.UTF-8"
    LC_ALL = "en_US.UTF-8"
    
    //BLAST output vars
    //BLOUTFMT = "6 qseqid qlen sseqid slen qstart qend sstart send length"
    //BLOUTFMT = "${BLOUTFMT} score evalue bitscore pident nident mismatch positive"
    //BLOUTFMT = "${BLOUTFMT} gapopen gaps ppos qframe sframe qseq sseq"
    
    // Kaiju params
    //kaiju_dbs="viruses, rvdb, refseq, nr_euk"
    
    
    //Further defs
    //BP_LOG = "$BDIR/logs/biopieces"
    BPCOL = 'SEQ_NAME,SEQ_LEN,RES[A],RES[C],RES[G],RES[T],GC%'
    BPCOL = "$BPCOL,SCORES_MIN,SCORES_MAX,SCORES_MEAN,SCORES_MEDIAN"

    TAB = "\t"
    RET = "\n"

    ZERO="###0###"
}

